"use strict";(globalThis.webpackChunkphysical_ai_book=globalThis.webpackChunkphysical_ai_book||[]).push([[4552],{6578:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"module-1-ros2-fundamentals/python-integration","title":"Python Integration with rclpy","description":"1. Introduction to rclpy","source":"@site/docs/module-1-ros2-fundamentals/python-integration.md","sourceDirName":"module-1-ros2-fundamentals","slug":"/module-1-ros2-fundamentals/python-integration","permalink":"/physical-ai-book/docs/module-1-ros2-fundamentals/python-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/RukhsarMalik/physical-ai-book/tree/main/docs/module-1-ros2-fundamentals/python-integration.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"python-integration","title":"Python Integration with rclpy","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Core Concepts","permalink":"/physical-ai-book/docs/module-1-ros2-fundamentals/concepts"},"next":{"title":"URDF Format Explained","permalink":"/physical-ai-book/docs/module-1-ros2-fundamentals/urdf"}}');var r=s(4848),l=s(8453);const o={id:"python-integration",title:"Python Integration with rclpy",sidebar_position:3},t=void 0,c={},d=[{value:"1. Introduction to rclpy",id:"1-introduction-to-rclpy",level:2},{value:"2. Setting up rclpy Environment",id:"2-setting-up-rclpy-environment",level:2},{value:"3. Creating a Simple Publisher Node",id:"3-creating-a-simple-publisher-node",level:2},{value:"4. Creating a Simple Subscriber Node",id:"4-creating-a-simple-subscriber-node",level:2},{value:"5. Running the Nodes Together",id:"5-running-the-nodes-together",level:2},{value:"6. Troubleshooting Common Issues",id:"6-troubleshooting-common-issues",level:2}];function a(e){const n={code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"1-introduction-to-rclpy",children:"1. Introduction to rclpy"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"rclpy"})," is the official Python client library for ROS 2. It provides a Pythonic interface to all the core ROS 2 functionalities, allowing developers to write nodes, publish/subscribe to topics, provide/request services, and manage actions using familiar Python syntax. ",(0,r.jsx)(n.code,{children:"rclpy"})," sits on top of ",(0,r.jsx)(n.code,{children:"rcl"})," (ROS Client Library), which is a C library providing the core logic, ensuring performance and consistency across different language bindings."]}),"\n",(0,r.jsxs)(n.p,{children:["Using ",(0,r.jsx)(n.code,{children:"rclpy"})," allows you to leverage Python's ease of use, extensive libraries for data processing, and rapid prototyping capabilities, making it an excellent choice for many ROS 2 applications, especially in areas like AI, data analysis, and high-level robot control."]}),"\n",(0,r.jsx)(n.h2,{id:"2-setting-up-rclpy-environment",children:"2. Setting up rclpy Environment"}),"\n",(0,r.jsxs)(n.p,{children:["Before you can write ",(0,r.jsx)(n.code,{children:"rclpy"})," code, you need a functional ROS 2 installation. Assuming you have ROS 2 installed (e.g., following the official ROS 2 documentation for your specific OS and distribution), you just need to ensure your development environment is correctly sourced."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Prerequisites:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A working ROS 2 installation (e.g., Humble Hawksbill, Iron Irwini)."}),"\n",(0,r.jsx)(n.li,{children:"Python 3 installed."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Installation Steps (usually part of ROS 2 setup):"}),"\r\n",(0,r.jsx)(n.code,{children:"rclpy"})," is typically installed as part of the standard ROS 2 desktop or base installation. If you installed ROS 2 using the recommended methods, ",(0,r.jsx)(n.code,{children:"rclpy"})," should already be available. You can verify this by trying to import ",(0,r.jsx)(n.code,{children:"rclpy"})," in a Python interpreter after sourcing your ROS 2 environment."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Sourcing your ROS 2 environment:"}),"\r\nEvery time you open a new terminal, you ",(0,r.jsx)(n.em,{children:"must"})," source your ROS 2 installation to make ROS 2 commands and libraries available."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Try it yourself:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# For Linux/macOS (replace humble with your ROS 2 distribution)\r\nsource /opt/ros/humble/setup.bash\r\n\r\n# For Windows (using PowerShell, replace humble with your ROS 2 distribution)\r\n# . C:\\dev\\ros2_humble\\setup.ps1\n"})}),"\n",(0,r.jsxs)(n.p,{children:["After sourcing, you should be able to run ROS 2 commands like ",(0,r.jsx)(n.code,{children:"ros2 run"})," and Python scripts that import ",(0,r.jsx)(n.code,{children:"rclpy"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"3-creating-a-simple-publisher-node",children:"3. Creating a Simple Publisher Node"}),"\n",(0,r.jsxs)(n.p,{children:['A publisher node sends messages to a topic. Let\'s create a node that publishes a "Hello ROS 2" message every second to a topic named ',(0,r.jsx)(n.code,{children:"/chat_message"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File"}),": ",(0,r.jsx)(n.code,{children:"simple_publisher.py"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String # Import the String message type\r\n\r\nclass SimplePublisher(Node):\r\n    def __init__(self):\r\n        super().__init__('simple_publisher') # Node name\r\n        self.publisher_ = self.create_publisher(String, 'chat_message', 10) # Topic name and QoS\r\n        timer_period = 1.0  # seconds\r\n        self.timer = self.create_timer(timer_period, self.timer_callback)\r\n        self.i = 0\r\n\r\n    def timer_callback(self):\r\n        msg = String()\r\n        msg.data = f'Hello ROS 2! Count: {self.i}'\r\n        self.publisher_.publish(msg)\r\n        self.get_logger().info(f'Publishing: \"{msg.data}\"') # Log what we're publishing\r\n        self.i += 1\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args) # Initialize ROS 2 communication\r\n    simple_publisher = SimplePublisher() # Create the node\r\n    rclpy.spin(simple_publisher) # Keep the node alive until Ctrl+C\r\n    simple_publisher.destroy_node() # Destroy the node explicitly\r\n    rclpy.shutdown() # Shutdown ROS 2 communication\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Line-by-line Explanation:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"import rclpy"})," and ",(0,r.jsx)(n.code,{children:"from rclpy.node import Node"}),": Imports the necessary ROS 2 Python client library."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"from std_msgs.msg import String"}),": Imports the ",(0,r.jsx)(n.code,{children:"String"})," message type from the ",(0,r.jsx)(n.code,{children:"std_msgs"})," package, which is used for simple text messages."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"class SimplePublisher(Node):"}),": Defines our node class, inheriting from ",(0,r.jsx)(n.code,{children:"rclpy.node.Node"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"super().__init__('simple_publisher')"}),": Calls the base class constructor and sets the unique name of our node to ",(0,r.jsx)(n.code,{children:"simple_publisher"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.publisher_ = self.create_publisher(String, 'chat_message', 10)"}),": Creates a publisher.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"String"}),": The message type to publish."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"'chat_message'"}),": The name of the topic."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"10"}),": The QoS (Quality of Service) history depth, a buffer for messages."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.timer = self.create_timer(timer_period, self.timer_callback)"}),": Creates a timer that will call ",(0,r.jsx)(n.code,{children:"self.timer_callback"})," every ",(0,r.jsx)(n.code,{children:"timer_period"})," seconds."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.timer_callback(self)"}),": This method is executed by the timer. It creates a ",(0,r.jsx)(n.code,{children:"String"})," message, populates its ",(0,r.jsx)(n.code,{children:"data"})," field, publishes it, and logs the action."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"main(args=None)"}),": The entry point for our ROS 2 Python executable."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"rclpy.init(args=args)"}),": Initializes the ",(0,r.jsx)(n.code,{children:"rclpy"})," library, enabling ROS 2 communication."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"rclpy.spin(simple_publisher)"}),": Keeps the node running until it's explicitly stopped (e.g., by ",(0,r.jsx)(n.code,{children:"Ctrl+C"}),"). It processes callbacks from the timer."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"simple_publisher.destroy_node()"}),": Cleans up the node resources."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"rclpy.shutdown()"}),": Shuts down the ",(0,r.jsx)(n.code,{children:"rclpy"})," library."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Try it yourself:"}),"\r\nSave the code as ",(0,r.jsx)(n.code,{children:"simple_publisher.py"}),". Before running, ensure your ROS 2 environment is sourced."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# In your terminal, after sourcing ROS 2\r\npython3 simple_publisher.py\n"})}),"\n",(0,r.jsx)(n.h2,{id:"4-creating-a-simple-subscriber-node",children:"4. Creating a Simple Subscriber Node"}),"\n",(0,r.jsxs)(n.p,{children:["A subscriber node listens for messages on a topic. Let's create a node that subscribes to the ",(0,r.jsx)(n.code,{children:"/chat_message"})," topic and prints any messages it receives."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"File"}),": ",(0,r.jsx)(n.code,{children:"simple_subscriber.py"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String # Import the String message type\r\n\r\nclass SimpleSubscriber(Node):\r\n    def __init__(self):\r\n        super().__init__('simple_subscriber') # Node name\r\n        self.subscription = self.create_subscription(\r\n            String,\r\n            'chat_message',\r\n            self.listener_callback,\r\n            10) # Topic name, QoS\r\n        self.subscription  # prevent unused variable warning\r\n\r\n    def listener_callback(self, msg):\r\n        self.get_logger().info(f'I heard: \"{msg.data}\"') # Log the received message\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    simple_subscriber = SimpleSubscriber()\r\n    rclpy.spin(simple_subscriber)\r\n    simple_subscriber.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Line-by-line Explanation:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.subscription = self.create_subscription(...)"}),": Creates a subscriber.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"String"}),": The message type to subscribe to."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"'chat_message'"}),": The name of the topic."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.listener_callback"}),": The callback function that will be executed every time a message is received."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"10"}),": The QoS history depth, matching the publisher."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.listener_callback(self, msg)"}),": This method is called when a message is received. It takes the received ",(0,r.jsx)(n.code,{children:"msg"})," object and logs its data."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Try it yourself:"}),"\r\nSave the code as ",(0,r.jsx)(n.code,{children:"simple_subscriber.py"}),". Before running, ensure your ROS 2 environment is sourced."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# In your terminal, after sourcing ROS 2\r\npython3 simple_subscriber.py\n"})}),"\n",(0,r.jsx)(n.h2,{id:"5-running-the-nodes-together",children:"5. Running the Nodes Together"}),"\n",(0,r.jsx)(n.p,{children:"To see the publisher and subscriber communicate, you need to run them concurrently in separate terminals."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Try it yourself:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Open Terminal 1:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Source your ROS 2 environment\r\nsource /opt/ros/humble/setup.bash # or your Windows equivalent\r\npython3 simple_publisher.py\n"})}),"\n",(0,r.jsx)(n.p,{children:"This terminal will show messages being published."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Open Terminal 2:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Source your ROS 2 environment\r\nsource /opt/ros/humble/setup.bash # or your Windows equivalent\r\npython3 simple_subscriber.py\n"})}),"\n",(0,r.jsx)(n.p,{children:"This terminal will show messages being received."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["You should observe the ",(0,r.jsx)(n.code,{children:"simple_subscriber"})," terminal displaying the messages published by the ",(0,r.jsx)(n.code,{children:"simple_publisher"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"6-troubleshooting-common-issues",children:"6. Troubleshooting Common Issues"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\"command not found: ros2\" or \"ImportError: cannot import name 'Node' from 'rclpy.node'\""}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": ROS 2 environment is not sourced."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Ensure you run ",(0,r.jsx)(n.code,{children:"source /opt/ros/<distro>/setup.bash"})," (Linux/macOS) or its Windows equivalent in ",(0,r.jsx)(n.em,{children:"every new terminal"})," before running ROS 2 commands or Python scripts."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Nodes not communicating"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Mismatched topic names, message types, or QoS settings between publisher and subscriber. Or, one of the nodes failed to start."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Double-check topic names (",(0,r.jsx)(n.code,{children:"ros2 topic list"}),", ",(0,r.jsx)(n.code,{children:"ros2 topic info <topic_name>"}),")."]}),"\n",(0,r.jsx)(n.li,{children:"Verify message types match."}),"\n",(0,r.jsx)(n.li,{children:"Ensure QoS history depth is compatible (e.g., both 10)."}),"\n",(0,r.jsx)(n.li,{children:"Look for error messages in the terminal where each node is running."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:'"Address already in use"'}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": A previous instance of a ROS 2 process might still be running in the background."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Close all terminals that were running ROS 2 nodes. If the issue persists, try restarting your terminal or machine."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Python syntax errors"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cause"}),": Typos in your Python code."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Carefully review your code against the examples, paying attention to indentation and syntax. Use a good IDE with Python linting."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>t});var i=s(6540);const r={},l=i.createContext(r);function o(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);